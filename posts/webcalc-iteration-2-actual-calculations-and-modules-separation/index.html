<!DOCTYPE html>
<html lang="en-gb">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="author" content="Jacek Bilski">
<meta name="generator" content="Hugo 0.54.0" />

    
    
    

<title>WebCalc iteration 2 - actual calculations and modules separation • On Software Engineering</title>
<meta name="description" content="WebCalc second iteration. I now have two Gradle subprojects and clearly separated calculator module. It now can actually add and subtract.">
<meta name="keywords" content="Gradle, JUnit 5, Spring, Spring Boot, testing, tests, TDD">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WebCalc iteration 2 - actual calculations and modules separation"/>
<meta name="twitter:description" content="WebCalc second iteration. I now have two Gradle subprojects and clearly separated calculator module. It now can actually add and subtract."/>
<meta name="twitter:site" content="@jacek_bilski"/>

<meta property="og:title" content="WebCalc iteration 2 - actual calculations and modules separation" />
<meta property="og:description" content="WebCalc second iteration. I now have two Gradle subprojects and clearly separated calculator module. It now can actually add and subtract." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.bilski.tech/posts/webcalc-iteration-2-actual-calculations-and-modules-separation/" />
<meta property="article:published_time" content="2018-09-21T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-09-21T00:00:00&#43;00:00"/>


    






<link rel="stylesheet" href="/scss/hyde-hyde.6b77503110258639e6f1aad73b37ed42e11b7fa20673b556f0f74f0d0f48b6f8.css" integrity="sha256-a3dQMRAlhjnm8arXOzftQuEbf6IGc7VW8PdPDQ9Itvg=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

    
<link href='https://cdnjs.cloudflare.com/ajax/libs/diff2html/2.7.0/diff2html.min.css' rel='stylesheet' type='text/css'/>
<style type='text/css'>
.d2h-wrapper {
    color: black;
    background: white;
    line-height: normal;
}
.d2h-wrapper td {
    padding: 0;
    border: none;
}
.d2h-wrapper table {
    margin-bottom: 0;
}
.d2h-file-diff {
    overflow-x: auto;
}
</style>
<script src='https://cdnjs.cloudflare.com/ajax/libs/diff2html/2.7.0/diff2html.min.js' type='text/javascript'></script>


</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.bilski.tech">On Software Engineering</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://www.bilski.tech/img/jacek.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
         Jacek Bilski&#39;s thoughts about software engineering and how to improve it 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">On Software Engineering</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About Me</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/jacek_bilski" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/jacekbilski" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	<a href="https://linkedin.com/in/jacek-bilski" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://www.xing.com/profile/Jacek_Bilski3" rel="me"><i class="fab fa-xing fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
</section>

      </div>
    </div>
    

<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>WebCalc iteration 2 - actual calculations and modules separation</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Sep 21, 2018<br/>
    
    <i class="fas fa-user-edit"></i> Jacek Bilski
    
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/gradle">gradle</a>
           
      
          <a class="badge badge-tag" href="/tags/junit-5">junit 5</a>
           
      
          <a class="badge badge-tag" href="/tags/spring">spring</a>
           
      
          <a class="badge badge-tag" href="/tags/spring-boot">spring boot</a>
           
      
          <a class="badge badge-tag" href="/tags/testing">testing</a>
           
      
          <a class="badge badge-tag" href="/tags/tests">tests</a>
           
      
          <a class="badge badge-tag" href="/tags/tdd">tdd</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 9 min read
</div>


  </header>
  
  
  <div class="post">
    <p>Welcome to the second iteration of WebCalc implementation. <a href="/posts/webcalc-iteration-1-setting-up-with-one-test/" target="_blank">Last time</a> I managed only to get a basic construct working and only in a very crude way. Always returning &ldquo;3&rdquo; from a controller is hardly a proper solution. This time I&rsquo;ll separate the app module from calculation one and then I&rsquo;ll start digging into actual calculations.</p>

<p>But first, looking at Gradle files I&rsquo;ve noticed a few unnecessary things. One thing is, that I&rsquo;m specifying explicit versions for JUnit and REST-Assured, which, having Spring Boot, is not necessary. Another is, that I&rsquo;m importing snapshots repositories I don&rsquo;t need. Yet another, I&rsquo;m using &ldquo;compile&rdquo; instead of &ldquo;implementation&rdquo; when specifying dependencies, where the former is not exactly deprecated, but the latter is preferred. And, at last, just by copy-pasting last time, I have a mix of single and double quotes, so I&rsquo;m changing all to double ones. See <a href="https://github.com/jacekbilski/WebCalc/commit/60acf6387906c6ffc194308dad41015f93372ba4" target="_blank">commit 60acf63</a>.  (May I express here my dislike to how many different syntaxes are allowed to do one thing? I didn&rsquo;t even start properly and already have a mess).</p>

<p>Having that aside I can focus again on the project. What I want to do is to move calculations from controller to calculator. That one doesn&rsquo;t exist, so I&rsquo;ll create it, starting of course with a test. Crazy enough the API will be very simple, take a string in, return a string, so all this parsing will be done on calculator side, not in the controller. Makes sense, a controller should only be responsible for handling the web part, so HTTP, declaring content type, etc. Parsing input belongs to the calculator. So, the test:</p>



<span id="c74a0e795d793c80444210d81c0438bc7c5a89ca"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: build.gradle\n===================================================================\n--- build.gradle\n\x2b\x2b\x2b build.gradle\n@@ -32,6 \x2b32,7 @@\n   testImplementation(\x22io.rest-assured:rest-assured\x22)\n   testImplementation(\x22org.junit.jupiter:junit-jupiter-api\x22)\n   testRuntime(\x22org.junit.jupiter:junit-jupiter-engine\x22)\n\x2b  testCompile(\x22org.assertj:assertj-core\x22)\n }\n\n test {\nIndex: src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -0,0 \x2b1,15 @@\n\x2bpackage com.webcalc.calculator;\n\x2b\n\x2bimport org.junit.jupiter.api.Test;\n\x2b\n\x2bimport static org.assertj.core.api.Assertions.assertThat;\n\x2b\n\x2bclass CalculatorShould {\n\x2b\n\x2b  @Test\n\x2b  void sum() {\n\x2b    Calculator calculator = new Calculator();\n\x2b    String result = calculator.eval(\x221 2 \x2b\x22);\n\x2b    assertThat(result).isEqualTo(\x223\x22);\n\x2b  }\n\x2b}\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("c74a0e795d793c80444210d81c0438bc7c5a89ca").innerHTML = diffHtml;
</script>


<p>To make it green I need an implementation. It cannot be any simpler than:</p>



<span id="83bab42e3b06aff35963e50b32579866db99e67e"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n===================================================================\n--- src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n\x2b\x2b\x2b src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n@@ -0,0 \x2b1,8 @@\n\x2bpackage com.webcalc.calculator;\n\x2b\n\x2bclass Calculator {\n\x2b\n\x2b  String eval(String input) {\n\x2b    return \x223\x22;\n\x2b  }\n\x2b}\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("83bab42e3b06aff35963e50b32579866db99e67e").innerHTML = diffHtml;
</script>


<p>Now I need to call the calculator from the controller, again, simple:</p>



<span id="2ee994615737d3853deb392a0e5571a8a4d16c37"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n===================================================================\n--- src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n\x2b\x2b\x2b src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n@@ -8,6 \x2b8,6 @@\n\n   @PostMapping(\x22\/eval\x22)\n   public String calculate() {\n-    return \x223\x22;\n\x2b    return new Calculator().eval(\x22\x22);\n   }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("2ee994615737d3853deb392a0e5571a8a4d16c37").innerHTML = diffHtml;
</script>


<p>A bit crude, but the tests work. Talking about tests, it seems, that WebCalcApplicationTests, which was generated automatically by Spring Initializr, is obsolete. It makes sure, that ApplicationContext is able to start, but my RestApiTest is also verifying that I need a fully working application there. It also takes some time to execute which I just noticed. I can delete WebCalcApplicationTests.</p>

<p>The controller needs to be cleaned up. First, I create a calculator field and initialise it in the constructor:</p>



<span id="cb07b1d531d951df8b43247ed5f81ad18d1e466e"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n===================================================================\n--- src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n\x2b\x2b\x2b src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n@@ -6,8 \x2b6,14 @@\n @RestController\n public class CalculatorController {\n\n\x2b  private final Calculator calculator;\n\x2b\n\x2b  public CalculatorController() {\n\x2b    calculator = new Calculator();\n\x2b  }\n\x2b\n   @PostMapping(\x22\/eval\x22)\n   public String calculate() {\n-    return new Calculator().eval(\x22\x22);\n\x2b    return calculator.eval(\x22\x22);\n   }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("cb07b1d531d951df8b43247ed5f81ad18d1e466e").innerHTML = diffHtml;
</script>


<p>Everything still works, but it&rsquo;s still not perfect, I don&rsquo;t want my controller to know how to create a calculator. I&rsquo;m going to do it Spring way, create it as a bean somewhere in Spring configuration and use constructor injection, like so:</p>



<span id="b13b904f119c16b31ae6e79442dbed1958f04efb"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: src\/main\/java\/com\/webcalc\/app\/WebCalcApplication.java\n===================================================================\n--- src\/main\/java\/com\/webcalc\/app\/WebCalcApplication.java\n\x2b\x2b\x2b src\/main\/java\/com\/webcalc\/app\/WebCalcApplication.java\n@@ -1,7 \x2b1,9 @@\n package com.webcalc.app;\n\n\x2bimport com.webcalc.calculator.Calculator;\n import org.springframework.boot.SpringApplication;\n import org.springframework.boot.autoconfigure.SpringBootApplication;\n\x2bimport org.springframework.context.annotation.Bean;\n import org.springframework.context.annotation.ComponentScan;\n\n @SpringBootApplication\n@@ -11,4 \x2b13,9 @@\n   public static void main(String[] args) {\n     SpringApplication.run(WebCalcApplication.class, args);\n   }\n\x2b\n\x2b  @Bean\n\x2b  public Calculator calculator() {\n\x2b    return new Calculator();\n\x2b  }\n }\nIndex: src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n===================================================================\n--- src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n\x2b\x2b\x2b src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n@@ -1,6 \x2b1,6 @@\n package com.webcalc.calculator;\n\n-class Calculator {\n\x2bpublic class Calculator {\n\n   String eval(String input) {\n     return \x223\x22;\nIndex: src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n===================================================================\n--- src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n\x2b\x2b\x2b src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n@@ -8,8 \x2b8,8 @@\n\n   private final Calculator calculator;\n\n-  public CalculatorController() {\n-    calculator = new Calculator();\n\x2b  public CalculatorController(Calculator calculator) {\n\x2b    this.calculator = calculator;\n   }\n\n   @PostMapping(\x22\/eval\x22)\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("b13b904f119c16b31ae6e79442dbed1958f04efb").innerHTML = diffHtml;
</script>


<p>OK, I have now three classes, that belong to different modules, business logic, web and app. Time for some Gradle subprojects.</p>

<p>The first step is quite big in terms of commit size but provides little more than setting up the stage. It is required though. I&rsquo;m creating a subproject in Gradle called &ldquo;app&rdquo; and I&rsquo;m moving everything in there. This module, in future, will hold only classes responsible for setting up everything, starting Spring, instantiating context, etc. See <a href="https://github.com/jacekbilski/WebCalc/commit/03e5db0bf93a36595098b1364eb2fd41266b3c3a" target="_blank">commit 03e5db0</a>.</p>

<p>Now things get more complex, as I want to extract a &ldquo;calculator&rdquo; module. That one will only have classes responsible for calculations and will be free of any framework dependencies, like Spring. It will also be compiled first. While doing that I faced some serious problems with, most likely, dependency management Gradle plugin from Spring Boot. Whenever I was trying to use it in calculator module, my tests in the app module were not seeing classes from the calculator. Playing around with Java, Gradle and Spring Boot versions didn&rsquo;t seem to make my situation better. But, as you might have noticed, I was &ldquo;inviting&rdquo; Spring Boot project into my calculation module. I&rsquo;m not going to pull in Spring itself, I just wanted to get the same version of JUnit and AssertJ everywhere, which this plugin could ensure. It didn&rsquo;t work (or I&rsquo;m too stupid to get it working correctly), so I had to go back to manually setting versions. Long story short: see <a href="https://github.com/jacekbilski/WebCalc/commit/460192005a3c064980ef64c4a9ad659052948a6e" target="_blank">commit 4601920</a>.</p>

<p>Enough with Gradle, right now the structure is better. I could extract also the web module, but I don&rsquo;t need it just yet, I only wanted to have calculator separated, because that&rsquo;s where I&rsquo;d focus next. First thing I want to do is to extend my test to be parametrised, so that I can easily add more test cases, like so:</p>



<span id="888921d39ce95ea674351cc774c3f3afa3934451"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/build.gradle\n===================================================================\n--- calculator\/build.gradle\n\x2b\x2b\x2b calculator\/build.gradle\n@@ -3,6 \x2b3,7 @@\n\n dependencies {\n   testImplementation(\x22org.junit.jupiter:junit-jupiter-api:${junitVersion}\x22)\n\x2b  testImplementation(\x22org.junit.jupiter:junit-jupiter-params:${junitVersion}\x22)\n   testRuntime(\x22org.junit.jupiter:junit-jupiter-engine:${junitVersion}\x22)\n   testImplementation(\x22org.assertj:assertj-core:${assertjVersion}\x22)\n }\nIndex: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -1,15 \x2b1,21 @@\n package com.webcalc.calculator;\n\n-import org.junit.jupiter.api.Test;\n\x2bimport org.junit.jupiter.api.DisplayName;\n\x2bimport org.junit.jupiter.params.ParameterizedTest;\n\x2bimport org.junit.jupiter.params.provider.CsvSource;\n\n import static org.assertj.core.api.Assertions.assertThat;\n\n class CalculatorShould {\n\n-  @Test\n-  void sum() {\n\x2b  @DisplayName(\x22Sum\x22)\n\x2b  @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n\x2b  @CsvSource({\n\x2b      \x221 2 \x2b, 3\x22\n\x2b  })\n\x2b  void sum(String input, String expectedResult) {\n     Calculator calculator = new Calculator();\n-    String result = calculator.eval(\x221 2 \x2b\x22);\n-    assertThat(result).isEqualTo(\x223\x22);\n\x2b    String result = calculator.eval(input);\n\x2b    assertThat(result).isEqualTo(expectedResult);\n   }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("888921d39ce95ea674351cc774c3f3afa3934451").innerHTML = diffHtml;
</script>


<p>Now I&rsquo;m adding a second test case, that would force me to stop blindly returning &ldquo;3&rdquo; from the calculator:</p>



<span id="2b817d091a4e4f9ef2296c7659dc49e16e444a51"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -11,7 \x2b11,8 @@\n   @DisplayName(\x22Sum\x22)\n   @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n   @CsvSource({\n-      \x221 2 \x2b, 3\x22\n\x2b      \x221 2 \x2b, 3\x22,\n\x2b      \x222 3 \x2b, 5\x22,\n   })\n   void sum(String input, String expectedResult) {\n     Calculator calculator = new Calculator();\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("2b817d091a4e4f9ef2296c7659dc49e16e444a51").innerHTML = diffHtml;
</script>


<p>Fixing this is quite easy, although I need to deal with parsing strings. At some later point in time, I&rsquo;ll probably separate parsing from calculations, but I don&rsquo;t know yet in which direction the code will go, so I&rsquo;m not doing it now.</p>



<span id="d70fe86a15323b8fe248f2b6759a163bf23aa8d3"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n===================================================================\n--- calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n\x2b\x2b\x2b calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n@@ -1,8 \x2b1,13 @@\n package com.webcalc.calculator;\n\n\x2bimport java.math.BigDecimal;\n\x2b\n public class Calculator {\n\n   String eval(String input) {\n-    return \x223\x22;\n\x2b    String[] tokens = input.split(\x22 \x22);\n\x2b    BigDecimal v1 = new BigDecimal(tokens[0]);\n\x2b    BigDecimal v2 = new BigDecimal(tokens[1]);\n\x2b    return v1.add(v2).toPlainString();\n   }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("d70fe86a15323b8fe248f2b6759a163bf23aa8d3").innerHTML = diffHtml;
</script>


<p>As you can see, I&rsquo;m using BigDecimals, although I don&rsquo;t need them just yet. It&rsquo;s a conscious decision, I don&rsquo;t want to rewrite all of the code once I reach a point, where I&rsquo;d need some floating point operations.</p>

<p>I&rsquo;m also adding a few test cases, just to be sure, that my adding also works for bigger numbers, as well as negative ones.</p>



<span id="cd95377686b605238f1dfdb391225dd9ff5b86d9"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -13,6 \x2b13,8 @@\n   @CsvSource({\n       \x221 2 \x2b, 3\x22,\n       \x222 3 \x2b, 5\x22,\n\x2b      \x220 -1 \x2b, -1\x22,\n\x2b      \x22-13 122 \x2b, 109\x22,\n   })\n   void sum(String input, String expectedResult) {\n     Calculator calculator = new Calculator();\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("cd95377686b605238f1dfdb391225dd9ff5b86d9").innerHTML = diffHtml;
</script>


<p>I used &ldquo;obvious implementation&rdquo; in the code, so no surprises here, all work.</p>

<p>I&rsquo;m going to extract the calculator as a field in the test, it will help me soon.</p>



<span id="1d10c7afcf8e682c6b4855c707cc070813f53ad7"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -8,6 \x2b8,8 @@\n\n class CalculatorShould {\n\n\x2b  private final Calculator calculator = new Calculator();\n\x2b\n   @DisplayName(\x22Sum\x22)\n   @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n   @CsvSource({\n@@ -17,7 \x2b19,6 @@\n       \x22-13 122 \x2b, 109\x22,\n   })\n   void sum(String input, String expectedResult) {\n-    Calculator calculator = new Calculator();\n     String result = calculator.eval(input);\n     assertThat(result).isEqualTo(expectedResult);\n   }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("1d10c7afcf8e682c6b4855c707cc070813f53ad7").innerHTML = diffHtml;
</script>


<p>Now I can add a new operation to the calculator: subtraction. As usual, I&rsquo;m starting with a test:</p>



<span id="a6b796638bce46cd848b39a88d91fdfb7bd4d07b"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -22,4 \x2b22,14 @@\n     String result = calculator.eval(input);\n     assertThat(result).isEqualTo(expectedResult);\n   }\n\x2b\n\x2b  @DisplayName(\x22Subtract\x22)\n\x2b  @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n\x2b  @CsvSource({\n\x2b      \x221 2 -, -1\x22,\n\x2b  })\n\x2b  void subtract(String input, String expectedResult) {\n\x2b    String result = calculator.eval(input);\n\x2b    assertThat(result).isEqualTo(expectedResult);\n\x2b  }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("a6b796638bce46cd848b39a88d91fdfb7bd4d07b").innerHTML = diffHtml;
</script>


<p>Implementation is quite obvious if not a bit dirty:</p>



<span id="1f3776d5f456902d0804dc04a20de030cc4ed388"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n===================================================================\n--- calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n\x2b\x2b\x2b calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n@@ -8,6 \x2b8,12 @@\n     String[] tokens = input.split(\x22 \x22);\n     BigDecimal v1 = new BigDecimal(tokens[0]);\n     BigDecimal v2 = new BigDecimal(tokens[1]);\n-    return v1.add(v2).toPlainString();\n\x2b    BigDecimal result;\n\x2b    if (\x22\x2b\x22.equals(tokens[2])) {\n\x2b      result = v1.add(v2);\n\x2b    } else {\n\x2b      result = v1.subtract(v2);\n\x2b    }\n\x2b    return result.toPlainString();\n   }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("1f3776d5f456902d0804dc04a20de030cc4ed388").innerHTML = diffHtml;
</script>


<p>Again, I&rsquo;m adding a few more test cases to also test negative and longer numbers.</p>



<span id="6f54b92dc0b873b408c0a5ab01aa169679a1e799"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -27,6 \x2b27,8 @@\n   @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n   @CsvSource({\n       \x221 2 -, -1\x22,\n\x2b      \x223 0 -, 3\x22,\n\x2b      \x222 -2 -, 4\x22,\n   })\n   void subtract(String input, String expectedResult) {\n     String result = calculator.eval(input);\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("6f54b92dc0b873b408c0a5ab01aa169679a1e799").innerHTML = diffHtml;
</script>


<p>So far so good. Am I sure? Not really! I was so into calculator module itself, that I didn&rsquo;t notice my integration test stopped working. But that&rsquo;s easy to fix:</p>



<span id="12d76b2b0641e6a32c5127dc38dc15b4b3ee2426"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: app\/src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n===================================================================\n--- app\/src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n\x2b\x2b\x2b app\/src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n@@ -1,6 \x2b1,7 @@\n package com.webcalc.calculator;\n\n import org.springframework.web.bind.annotation.PostMapping;\n\x2bimport org.springframework.web.bind.annotation.RequestBody;\n import org.springframework.web.bind.annotation.RestController;\n\n @RestController\n@@ -13,7 \x2b14,7 @@\n   }\n\n   @PostMapping(\x22\/eval\x22)\n-  public String calculate() {\n-    return calculator.eval(\x22\x22);\n\x2b  public String calculate(@RequestBody String body) {\n\x2b    return calculator.eval(body);\n   }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("12d76b2b0641e6a32c5127dc38dc15b4b3ee2426").innerHTML = diffHtml;
</script>


<p>And that would be all this time. I definitely have a messy implementation of calculator itself, that I&rsquo;d need to deal with soon. After I add a few more operations, and maybe partial support for floating point operations in the next iteration, maybe it will be more clear how to clean it up. Also, the tests for addition and subtraction look worryingly similar, for multiplication and division they would also look the same. But here, although it&rsquo;s an obvious duplication I don&rsquo;t want to merge them because they&rsquo;re theoretically testing different operations. Or maybe I should? I&rsquo;ll see <a href="/posts/webcalc-iteration-3-formatting-and-cleanup-in-calculator-module/" target="_blank">next time</a>. See you later!</p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/webcalc-iteration-1-setting-up-with-one-test/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">WebCalc iteration 1 - setting up with one test</span>
    </a>
    
    
    <a href="/posts/webcalc-iteration-3-formatting-and-cleanup-in-calculator-module/" class="navigation-next">
      <span class="navigation-tittle">WebCalc iteration 3 - formatting and cleanup in calculator module</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
