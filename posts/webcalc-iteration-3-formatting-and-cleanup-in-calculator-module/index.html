<!DOCTYPE html>
<html lang="en-gb">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="author" content="Jacek Bilski">
<meta name="generator" content="Hugo 0.54.0" />

    
    
    

<title>WebCalc iteration 3 - formatting and cleanup in calculator module • On Software Engineering</title>
<meta name="description" content="WebCalc third iteration. I&#39;m adding multiplication and division. During that I need to deal with formatting and limiting number of digits.">
<meta name="keywords" content="JUnit 5, testing, tests, TDD">
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WebCalc iteration 3 - formatting and cleanup in calculator module"/>
<meta name="twitter:description" content="WebCalc third iteration. I&#39;m adding multiplication and division. During that I need to deal with formatting and limiting number of digits."/>
<meta name="twitter:site" content="@jacek_bilski"/>

<meta property="og:title" content="WebCalc iteration 3 - formatting and cleanup in calculator module" />
<meta property="og:description" content="WebCalc third iteration. I&#39;m adding multiplication and division. During that I need to deal with formatting and limiting number of digits." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.bilski.tech/posts/webcalc-iteration-3-formatting-and-cleanup-in-calculator-module/" />
<meta property="article:published_time" content="2018-10-10T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2018-10-10T00:00:00&#43;00:00"/>


    






<link rel="stylesheet" href="/scss/hyde-hyde.d8e474f8dcee7b234bc8afe1479c3b44440642d23eebbb8b4977250a46484d42.css" integrity="sha256-2OR0&#43;NzueyNLyK/hR5w7REQGQtI&#43;67uLSXclCkZITUI=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    

    
<link href='https://cdnjs.cloudflare.com/ajax/libs/diff2html/2.7.0/diff2html.min.css' rel='stylesheet' type='text/css'/>
<style type='text/css'>
.d2h-wrapper {
    color: black;
    background: white;
    line-height: normal;
}
.d2h-wrapper td {
    padding: 0;
    border: none;
}
.d2h-wrapper table {
    margin-bottom: 0;
}
.d2h-file-diff {
    overflow-x: auto;
}
</style>
<script src='https://cdnjs.cloudflare.com/ajax/libs/diff2html/2.7.0/diff2html.min.js' type='text/javascript'></script>


</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.bilski.tech/">On Software Engineering</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://www.bilski.tech/img/jacek.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
         Jacek Bilski&#39;s thoughts about software engineering and how to improve it 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">On Software Engineering</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/">
						<span>About Me</span>
					</a>
				</li>
			 
		
		</li>
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/jacek_bilski" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/jacekbilski" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	<a href="https://linkedin.com/in/jacek-bilski" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://www.xing.com/profile/Jacek_Bilski3" rel="me"><i class="fab fa-xing fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
</section>

      </div>
    </div>
    

<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    <article>
  <header>
    <h1>WebCalc iteration 3 - formatting and cleanup in calculator module</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Oct 10, 2018<br/>
    
    <i class="fas fa-user-edit"></i> Jacek Bilski
    
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/junit-5">junit 5</a>
           
      
          <a class="badge badge-tag" href="/tags/testing">testing</a>
           
      
          <a class="badge badge-tag" href="/tags/tests">tests</a>
           
      
          <a class="badge badge-tag" href="/tags/tdd">tdd</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 8 min read
</div>


  </header>
  
  
  <div class="post">
    <p>Welcome to the third iteration of WebCalc implementation. <a href="/posts/webcalc-iteration-2-actual-calculations-and-modules-separation/" target="_blank">Previously</a> I managed to get only basic operations working, namely addition and subtraction. This time I want to go further and add multiplication and division. Whereas multiplication should be pretty straightforward, I&rsquo;m expecting issues with the division. Once I get these things working, I&rsquo;ll see if I can improve the design of calculator itself and the tests. To IDE then.</p>

<p>Multiplication is, indeed, straightforward. I copy subtraction test (which still bothers me, but I don&rsquo;t see a better solution yet) and modify it accordingly, like so:</p>



<span id="07cf692dadc129d61f6154eb481f3137f5666a81"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -34,4 \x2b34,14 @@\n     String result = calculator.eval(input);\n     assertThat(result).isEqualTo(expectedResult);\n   }\n\x2b\n\x2b  @DisplayName(\x22Multiply\x22)\n\x2b  @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n\x2b  @CsvSource({\n\x2b      \x221 2 *, 2\x22,\n\x2b  })\n\x2b  void multiply(String input, String expectedResult) {\n\x2b    String result = calculator.eval(input);\n\x2b    assertThat(result).isEqualTo(expectedResult);\n\x2b  }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("07cf692dadc129d61f6154eb481f3137f5666a81").innerHTML = diffHtml;
</script>


<p>Implementation is a tiny bit more complicated because I need to replace an if there with something else. Well, I could use &lsquo;else if&rsquo;, but instead I&rsquo;ll use a switchover strings, never done that before honestly. Everything else is obvious:</p>



<span id="af224dc6ab22437ceb2ce8af87a1fff178fd3885"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n===================================================================\n--- calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n\x2b\x2b\x2b calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n@@ -9,10 \x2b9,18 @@\n     BigDecimal v1 = new BigDecimal(tokens[0]);\n     BigDecimal v2 = new BigDecimal(tokens[1]);\n     BigDecimal result;\n-    if (\x22\x2b\x22.equals(tokens[2])) {\n-      result = v1.add(v2);\n-    } else {\n-      result = v1.subtract(v2);\n\x2b    switch (tokens[2]) {\n\x2b      case \x22\x2b\x22:\n\x2b        result = v1.add(v2);\n\x2b        break;\n\x2b      case \x22-\x22:\n\x2b        result = v1.subtract(v2);\n\x2b        break;\n\x2b      case \x22*\x22:\n\x2b        result = v1.multiply(v2);\n\x2b        break;\n\x2b      default:\n\x2b        throw new RuntimeException(\x22Unsupported operation: \x22 \x2b tokens[2]);\n     }\n     return result.toPlainString();\n   }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("af224dc6ab22437ceb2ce8af87a1fff178fd3885").innerHTML = diffHtml;
</script>


<p>I&rsquo;m adding a few more test cases, just for completeness sake.</p>



<span id="c16e7827f90bcf19eeede5a3ba71dd8d340e0527"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -39,6 \x2b39,9 @@\n   @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n   @CsvSource({\n       \x221 2 *, 2\x22,\n\x2b      \x223 0 *, 0\x22,\n\x2b      \x22-12 12 *, -144\x22,\n\x2b      \x22-3 -5 *, 15\x22,\n   })\n   void multiply(String input, String expectedResult) {\n     String result = calculator.eval(input);\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("c16e7827f90bcf19eeede5a3ba71dd8d340e0527").innerHTML = diffHtml;
</script>


<p>No surprises here, implementation is correct.</p>

<p>Division starts fairly simple. Yet another copy of tests and I have:</p>



<span id="c9c64f7c1e05f30566c1205629f9daf5122d18fb"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -47,4 \x2b47,14 @@\n     String result = calculator.eval(input);\n     assertThat(result).isEqualTo(expectedResult);\n   }\n\x2b\n\x2b  @DisplayName(\x22Divide\x22)\n\x2b  @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n\x2b  @CsvSource({\n\x2b      \x222 1 \/, 2\x22,\n\x2b  })\n\x2b  void divide(String input, String expectedResult) {\n\x2b    String result = calculator.eval(input);\n\x2b    assertThat(result).isEqualTo(expectedResult);\n\x2b  }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("c9c64f7c1e05f30566c1205629f9daf5122d18fb").innerHTML = diffHtml;
</script>


<p>So far the implementation can look like this:</p>



<span id="186a577c5984d757353eaaf3d9cd1c50317b0e75"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n===================================================================\n--- calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n\x2b\x2b\x2b calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n@@ -19,6 \x2b19,9 @@\n       case \x22*\x22:\n         result = v1.multiply(v2);\n         break;\n\x2b      case \x22\/\x22:\n\x2b        result = v1.divide(v2);\n\x2b        break;\n       default:\n         throw new RuntimeException(\x22Unsupported operation: \x22 \x2b tokens[2]);\n     }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("186a577c5984d757353eaaf3d9cd1c50317b0e75").innerHTML = diffHtml;
</script>


<p>Works for now. Now it will get trickier because I want to leave a world of integers. I&rsquo;m adding a simple test case:</p>



<span id="7dcbb265b2d8ba840822d57fb172096b0e552728"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -52,6 \x2b52,7 @@\n   @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n   @CsvSource({\n       \x222 1 \/, 2\x22,\n\x2b      \x221 2 \/, \x270,5\x27\x22,\n   })\n   void divide(String input, String expectedResult) {\n     String result = calculator.eval(input);\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("7dcbb265b2d8ba840822d57fb172096b0e552728").innerHTML = diffHtml;
</script>


<p>It failed because of the decimal point. I&rsquo;m from Poland, currently living in Germany, and in both those countries, we&rsquo;re using comma as a decimal point, not a dot. Java, when converting BigDecimals to strings, is always using the dot. If I want to get a coma in string representation, I need to format the numbers using NumberFormat, like so:</p>



<span id="5f810e80942b2abdfb8e8ccc19c3055f4893690a"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n===================================================================\n--- calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n\x2b\x2b\x2b calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n@@ -1,9 \x2b1,13 @@\n package com.webcalc.calculator;\n\n import java.math.BigDecimal;\n\x2bimport java.text.NumberFormat;\n\x2bimport java.util.Locale;\n\n public class Calculator {\n\n\x2b  private NumberFormat formatter = NumberFormat.getNumberInstance(Locale.GERMANY);\n\x2b\n   String eval(String input) {\n     String[] tokens = input.split(\x22 \x22);\n     BigDecimal v1 = new BigDecimal(tokens[0]);\n@@ -25,6 \x2b29,6 @@\n       default:\n         throw new RuntimeException(\x22Unsupported operation: \x22 \x2b tokens[2]);\n     }\n-    return result.toPlainString();\n\x2b    return formatter.format(result);\n   }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("5f810e80942b2abdfb8e8ccc19c3055f4893690a").innerHTML = diffHtml;
</script>


<p>Now I have a coma. Next problem to solve is rounding. The division is the first operation, that can produce infinite expansion, but I need a finite number of digits to return. I don&rsquo;t know if that&rsquo;s a good idea, but I&rsquo;ll add to the Calculator a possibility of setting max fraction digits.</p>

<p>Digression, in hindsight, it&rsquo;s a bad idea and I&rsquo;ll have to fix it later, at the beginning of 4th iteration probably. Although I&rsquo;ve found it out after writing the code and during writing this article, I decided not to go back, fix it immediately and hide my failure from everybody. It happens to me all the time, and not only to me. We&rsquo;re all making mistakes, we just need to reflect on them and learn from them. It is a very important part of software engineering.</p>

<p>Back to code, merely adding a test case will not be enough this time, I&rsquo;ll need to change a bit more. This is the moment, where all test methods stop looking exactly the same way, so making a copy for a division was a good decision. Now my test looks like this:</p>



<span id="f7b4e66b945c0bc1f74be3d08b07111a4404fbe1"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -49,12 \x2b49,14 @@\n   }\n\n   @DisplayName(\x22Divide\x22)\n-  @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n\x2b  @ParameterizedTest(name = \x22input: \x27\x27{0}\x27\x27, max fraction digits: \x27\x27{2}\x27\x27, expected result: \x27\x27{1}\x27\x27\x22)\n   @CsvSource({\n-      \x222 1 \/, 2\x22,\n-      \x221 2 \/, \x270,5\x27\x22,\n\x2b      \x222 1 \/, 2, 2\x22,\n\x2b      \x221 2 \/, \x270,5\x27, 2\x22,\n\x2b      \x222 3 \/, \x270,67\x27, 2\x22,\n   })\n-  void divide(String input, String expectedResult) {\n\x2b  void divide(String input, String expectedResult, int maxFractionDigits) {\n\x2b    calculator.setMaxFractionDigits(maxFractionDigits);\n     String result = calculator.eval(input);\n     assertThat(result).isEqualTo(expectedResult);\n   }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("f7b4e66b945c0bc1f74be3d08b07111a4404fbe1").innerHTML = diffHtml;
</script>


<p>Calculator needs to get its setMaxFractionDigits:</p>



<span id="f2b3ee7b7c0f2474514ae69a46141f3072f6dfca"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n===================================================================\n--- calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n\x2b\x2b\x2b calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n@@ -1,6 \x2b1,7 @@\n package com.webcalc.calculator;\n\n import java.math.BigDecimal;\n\x2bimport java.math.RoundingMode;\n import java.text.NumberFormat;\n import java.util.Locale;\n\n@@ -8,6 \x2b9,12 @@\n\n   private NumberFormat formatter = NumberFormat.getNumberInstance(Locale.GERMANY);\n\n\x2b  private int maxFractionDigits;\n\x2b\n\x2b  void setMaxFractionDigits(int maxFractionDigits) {\n\x2b    this.maxFractionDigits = maxFractionDigits;\n\x2b  }\n\x2b\n   String eval(String input) {\n     String[] tokens = input.split(\x22 \x22);\n     BigDecimal v1 = new BigDecimal(tokens[0]);\n@@ -24,7 \x2b31,7 @@\n         result = v1.multiply(v2);\n         break;\n       case \x22\/\x22:\n-        result = v1.divide(v2);\n\x2b        result = v1.divide(v2, maxFractionDigits, RoundingMode.HALF_UP);\n         break;\n       default:\n         throw new RuntimeException(\x22Unsupported operation: \x22 \x2b tokens[2]);\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("f2b3ee7b7c0f2474514ae69a46141f3072f6dfca").innerHTML = diffHtml;
</script>


<p>So far it works. As usual, I&rsquo;m adding a few test cases to find out if I&rsquo;ve covered all cases:</p>



<span id="baf1aefe2653639a44ad1e49881ae485af869443"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n===================================================================\n--- calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n\x2b\x2b\x2b calculator\/src\/test\/java\/com\/webcalc\/calculator\/CalculatorShould.java\n@@ -54,6 \x2b54,9 @@\n       \x222 1 \/, 2, 2\x22,\n       \x221 2 \/, \x270,5\x27, 2\x22,\n       \x222 3 \/, \x270,67\x27, 2\x22,\n\x2b      \x229 -4 \/, \x27-2,25\x27, 9\x22,\n\x2b      \x22-47 -13 \/, \x273,615384615\x27, 9\x22,\n\x2b      \x223 2 \/, 2, 0\x22,\n   })\n   void divide(String input, String expectedResult, int maxFractionDigits) {\n     calculator.setMaxFractionDigits(maxFractionDigits);\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("baf1aefe2653639a44ad1e49881ae485af869443").innerHTML = diffHtml;
</script>


<p>Funny enough I didn&rsquo;t. Although I was limiting max fraction digits in the division, printing number out, just by accident, was also using maximum 2 fraction digits. In the end, I didn&rsquo;t notice, that I&rsquo;ve missed something. When I asked for higher (or lower) precision, I didn&rsquo;t get what I wanted. Fix is simple:</p>



<span id="811a08b0f8dc60f12cb6fee5093e25d80ea52f8b"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n===================================================================\n--- calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n\x2b\x2b\x2b calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n@@ -13,6 \x2b13,7 @@\n\n   void setMaxFractionDigits(int maxFractionDigits) {\n     this.maxFractionDigits = maxFractionDigits;\n\x2b    formatter.setMaximumFractionDigits(maxFractionDigits);\n   }\n\n   String eval(String input) {\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("811a08b0f8dc60f12cb6fee5093e25d80ea52f8b").innerHTML = diffHtml;
</script>


<p>I&rsquo;m looking at the Calculator and I think that the eval method has grown beyond my liking. Especially this big switch is bothering me. Luckily Java has something like BinaryOperator, that I can use, so I&rsquo;m extracting a method finding out what kind of function needs to be applied to two values.</p>



<span id="73934d92164a3bd9f2d854fd36d9df3aba4f333c"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n===================================================================\n--- calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n\x2b\x2b\x2b calculator\/src\/main\/java\/com\/webcalc\/calculator\/Calculator.java\n@@ -4,6 \x2b4,7 @@\n import java.math.RoundingMode;\n import java.text.NumberFormat;\n import java.util.Locale;\n\x2bimport java.util.function.BinaryOperator;\n\n public class Calculator {\n\n@@ -20,23 \x2b21,23 @@\n     String[] tokens = input.split(\x22 \x22);\n     BigDecimal v1 = new BigDecimal(tokens[0]);\n     BigDecimal v2 = new BigDecimal(tokens[1]);\n-    BigDecimal result;\n-    switch (tokens[2]) {\n\x2b    BinaryOperator\x3cbigdecimal\x3e f = function(tokens[2]);\n\x2b    BigDecimal result = f.apply(v1, v2);\n\x2b    return formatter.format(result);\n\x2b  }\n\x2b\n\x2b  private BinaryOperator\x3cbigdecimal\x3e function(String function) {\n\x2b    switch (function) {\n       case \x22\x2b\x22:\n-        result = v1.add(v2);\n-        break;\n\x2b        return BigDecimal::add;\n       case \x22-\x22:\n-        result = v1.subtract(v2);\n-        break;\n\x2b        return BigDecimal::subtract;\n       case \x22*\x22:\n-        result = v1.multiply(v2);\n-        break;\n\x2b        return BigDecimal::multiply;\n       case \x22\/\x22:\n-        result = v1.divide(v2, maxFractionDigits, RoundingMode.HALF_UP);\n-        break;\n\x2b        return (v1, v2) -\x3e v1.divide(v2, maxFractionDigits, RoundingMode.HALF_UP);\n       default:\n-        throw new RuntimeException(\x22Unsupported operation: \x22 \x2b tokens[2]);\n\x2b        throw new RuntimeException(\x22Unsupported function: \x22 \x2b function);\n     }\n-    return formatter.format(result);\n   }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("73934d92164a3bd9f2d854fd36d9df3aba4f333c").innerHTML = diffHtml;
</script>


<p>I think the Calculator itself is now more complete, I don&rsquo;t yet see any applicable improvements. Parsing string looks like a candidate, but it would change once I start dealing with more than one operation on two numbers, so I&rsquo;m leaving it like it is. Also looking at calculator tests I still cannot figure out if I should merge adding, subtracting and multiplicating together. They seem very similar, but operations are different after all. I&rsquo;ll probably stop tormenting myself with that and leave it be. I can always return here later on and merge if that would make sense.</p>

<p>It&rsquo;s time to see if something needs to be changed from the REST interface perspective. Indeed, setting max fraction digits is not handled at all, and I should probably also test division from outside, as it is quite different from all other operations implemented so far. My new test hitting the application from outside looks like this:</p>



<span id="ab22b184d1475a9a3dfd095821936c1b964f0e58"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: app\/src\/test\/java\/com\/webcalc\/integration_tests\/RestApiTest.java\n===================================================================\n--- app\/src\/test\/java\/com\/webcalc\/integration_tests\/RestApiTest.java\n\x2b\x2b\x2b app\/src\/test\/java\/com\/webcalc\/integration_tests\/RestApiTest.java\n@@ -20,4 \x2b20,21 @@\n     .then()\n         .body(equalTo(\x223\x22));\n   }\n\x2b\n\x2b  @Test\n\x2b  void settingMaxFractionDigits() {\n\x2b    given()\n\x2b        .body(\x225\x22)\n\x2b    .when()\n\x2b        .put(\x22\/maxFractionDigits\x22)\n\x2b    .then()\n\x2b        .statusCode(200);\n\x2b\n\x2b    given()\n\x2b        .body(\x228 7 \/\x22)\n\x2b    .when()\n\x2b        .post(\x22\/eval\x22)\n\x2b    .then()\n\x2b        .body(equalTo(\x221,14286\x22));\n\x2b  }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("ab22b184d1475a9a3dfd095821936c1b964f0e58").innerHTML = diffHtml;
</script>


<p>Fixing the controller is straightforward:</p>



<span id="0d0b2436b8b35754208dfa6c57d780d64844a859"></span>
<script>
    var diffHtml = Diff2Html.getPrettyHtml(
        "Index: app\/src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n===================================================================\n--- app\/src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n\x2b\x2b\x2b app\/src\/main\/java\/com\/webcalc\/calculator\/CalculatorController.java\n@@ -1,6 \x2b1,7 @@\n package com.webcalc.calculator;\n\n import org.springframework.web.bind.annotation.PostMapping;\n\x2bimport org.springframework.web.bind.annotation.PutMapping;\n import org.springframework.web.bind.annotation.RequestBody;\n import org.springframework.web.bind.annotation.RestController;\n\n@@ -17,4 \x2b18,9 @@\n   public String calculate(@RequestBody String body) {\n     return calculator.eval(body);\n   }\n\x2b\n\x2b  @PutMapping(\x22\/maxFractionDigits\x22)\n\x2b  public void setMaxFractionDigits(@RequestBody String body) {\n\x2b    calculator.setMaxFractionDigits(Integer.parseInt(body));\n\x2b  }\n }\n",
        {inputFormat: 'diff', showFiles: false, matching: 'word', outputFormat: 'line-by-line'}
    );
    document.getElementById("0d0b2436b8b35754208dfa6c57d780d64844a859").innerHTML = diffHtml;
</script>


<p>That will be all this time. <a href="/posts/webcalc-iteration-4-fixes-only/" target="_blank">Next time</a> I&rsquo;ll start by fixing handling of max fraction digits. I&rsquo;ll also stick to Calculator itself and add a possibility of doing some more complex calculations. See you next time!</p>

  </div>
  


  

  
    
        <script src="https://utteranc.es/client.js"
        repo="jacekbilski/jacekbilski.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
    


</article>


        </div>
        
    
<script defer src="https://use.fontawesome.com/releases/v5.5.0/js/all.js" integrity="sha384-GqVMZRt5Gn7tB9D9q7ONtcp4gtHIUEW/yG7h98J7IpE3kpi+srfFyyB/04OV6pG0" crossorigin="anonymous"></script>


    
    
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    




    



    </body>
</html>
